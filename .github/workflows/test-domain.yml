name: 测试域名访问

on:
  workflow_dispatch:

jobs:
  test-domain:
    runs-on: ubuntu-latest

    steps:
    - name: 测试域名访问
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        password: ${{ secrets.SERVER_PASSWORD }}
        port: ${{ secrets.SERVER_PORT || 22 }}
        script: |
          echo "========== 测试通过域名访问 =========="
          curl -I http://ey.yushuo.click/

          echo ""
          echo "========== 测试API =========="
          curl -I http://ey.yushuo.click/api/

          echo ""
          echo "========== 检查Nginx配置 =========="
          grep "server_name" /www/server/panel/vhost/nginx/ey.yushuo.click.conf

          echo ""
          echo "完成！"
