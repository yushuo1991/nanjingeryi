var se=Object.defineProperty,le=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var M=(o,r,t)=>r in o?se(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,h=(o,r)=>{for(var t in r||(r={}))ae.call(r,t)&&M(o,t,r[t]);if(O)for(var t of O(r))re.call(r,t)&&M(o,t,r[t]);return o},j=(o,r)=>le(o,te(r));var A=(o,r,t)=>new Promise((u,a)=>{var x=i=>{try{c(t.next(i))}catch(b){a(b)}},n=i=>{try{c(t.throw(i))}catch(b){a(b)}},c=i=>i.done?u(i.value):Promise.resolve(i.value).then(x,n);c((t=t.apply(o,r)).next())});import{c as k,j as e,r as g,b as ne}from"./index-Cs5sQcoR-1772246974185.js";import{M as U,P as s,C as oe,F as de,U as ie,a as ce,T as xe,X as me,b as ue,c as S,S as L}from"./RehabCareLink-CvJsYKDp-1772246974185.js";import{C as B}from"./check-CksQ7IAE-1772246974185.js";import{T as be}from"./trash-2-BFJgIg_4-1772246974185.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=k("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=k("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=k("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),je=({message:o="AI识别中..."})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsxs("div",{className:"loader",children:[e.jsx("div",{className:"ground",children:e.jsx("div",{})}),e.jsx("div",{className:"box box0",children:e.jsx("div",{})}),e.jsx("div",{className:"box box1",children:e.jsx("div",{})}),e.jsx("div",{className:"box box2",children:e.jsx("div",{})}),e.jsx("div",{className:"box box3",children:e.jsx("div",{})}),e.jsx("div",{className:"box box4",children:e.jsx("div",{})}),e.jsx("div",{className:"box box5",children:e.jsx("div",{})}),e.jsx("div",{className:"box box6",children:e.jsx("div",{})}),e.jsx("div",{className:"box box7",children:e.jsx("div",{})})]}),o&&e.jsx("p",{className:"text-sm text-slate-600 mt-4 font-medium",children:o})]}),G=({isOpen:o,onClose:r,currentItem:t,alternatives:u,onReplace:a})=>{if(!t)return null;const x=n=>{a(n),r()};return e.jsx(U,{isOpen:o,onClose:r,title:"替换治疗项目",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-800",children:t.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["当前项目 · ",t.duration]})]})]}),t.note&&e.jsx("p",{className:"text-xs text-slate-600 mt-2 whitespace-pre-line line-clamp-3",children:t.note})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(E,{size:16,className:"text-blue-500"}),"可替换为以下项目"]}),u.length===0?e.jsxs("div",{className:"text-center py-8 text-slate-400",children:[e.jsx("p",{className:"text-sm",children:"暂无可替换的项目"}),e.jsx("p",{className:"text-xs mt-1",children:"该类别的其他项目已在方案中"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:u.map(n=>e.jsx("button",{onClick:()=>x(n),className:"w-full bg-white border border-slate-200 rounded-xl p-4 text-left hover:border-blue-400 hover:bg-blue-50 transition-all group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl flex-shrink-0",children:n.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-slate-800 group-hover:text-blue-600",children:n.name}),e.jsx("span",{className:"text-xs text-slate-500",children:n.duration})]}),n.适用状态&&n.适用状态.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:n.适用状态.map((c,i)=>e.jsx("span",{className:"text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded-full",children:c},i))}),n.禁忌&&n.禁忌.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:n.禁忌.map((c,i)=>e.jsxs("span",{className:"text-xs bg-rose-100 text-rose-600 px-2 py-0.5 rounded-full",children:["禁忌：",c]},i))}),n.note&&e.jsx("p",{className:"text-xs text-slate-600 mt-2 whitespace-pre-line line-clamp-2",children:n.note})]}),e.jsx(B,{size:20,className:"text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"})]})},n.id))})]}),e.jsx("div",{className:"flex gap-2 pt-2",children:e.jsx("button",{onClick:r,className:"flex-1 py-2 px-4 rounded-xl text-sm font-semibold text-slate-600 bg-slate-100 hover:bg-slate-200 transition-all",children:"取消"})})]})})};G.propTypes={isOpen:s.bool.isRequired,onClose:s.func.isRequired,currentItem:s.shape({id:s.oneOfType([s.string,s.number]),name:s.string,icon:s.string,duration:s.string,note:s.string,category:s.string,适用状态:s.arrayOf(s.string),禁忌:s.arrayOf(s.string)}),alternatives:s.arrayOf(s.shape({id:s.oneOfType([s.string,s.number]),name:s.string,icon:s.string,duration:s.string,note:s.string,category:s.string,适用状态:s.arrayOf(s.string),禁忌:s.arrayOf(s.string)})).isRequired,onReplace:s.func.isRequired};const H=({isOpen:o,onClose:r,aiStep:t,setAiStep:u,aiResult:a,setAiResult:x,uploadedImage:n,setUploadedImage:c,ocrText:i,setOcrText:b,ocrProgress:ge,setOcrProgress:q,handleImageUpload:J,updateFormField:p,addSafetyAlert:f,removeSafetyAlert:D,addTreatmentItem:K,updateTreatmentItem:P,removeTreatmentItem:V,handleGeneratePlan:X,confirmAdmission:$,isOcrProcessing:z,isSavingPatient:N,departments:Q})=>{var R;const[v,y]=g.useState(""),[W,w]=g.useState(!1),[C,Y]=g.useState(null),[Z,I]=g.useState([]),_=()=>{r(),u(0),x(null),c(null),b(""),q(0)},F=l=>A(null,null,function*(){const d=a.treatmentPlan.items[l];Y(l);try{const T=yield(yield fetch("/api/treatment/alternatives",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentItemId:d.id,category:d.category||"active",currentPlan:a.treatmentPlan.items})})).json();T.success&&(I(T.alternatives),w(!0))}catch(m){console.error("获取备选项目失败:",m),I([]),w(!0)}}),ee=l=>{const d=[...a.treatmentPlan.items];d[C]=j(h({},l),{id:Date.now(),completed:!1}),x(m=>j(h({},m),{treatmentPlan:j(h({},m.treatmentPlan),{items:d})}))};return e.jsxs(U,{isOpen:o,onClose:_,title:"AI智能建档",icon:e.jsx(L,{className:"text-blue-500",size:20}),children:[t===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-100 to-purple-100 rounded-3xl flex items-center justify-center mx-auto mb-4 border-2 border-white shadow-md",children:e.jsx(he,{size:36,className:"text-blue-500"})}),e.jsx("h4",{className:"text-lg font-bold text-slate-800 mb-2",children:"上传病历资料"}),e.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"上传病历图片，AI将自动识别并提取患者信息"}),e.jsx("input",{type:"file",id:"medical-record-upload",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:!0,onChange:J,className:"hidden"}),e.jsxs("label",{htmlFor:"medical-record-upload",className:"block border-2 border-dashed border-slate-200 rounded-3xl p-8 mb-4 hover:border-blue-400 hover:bg-blue-50 transition-all cursor-pointer",children:[e.jsx(pe,{size:32,className:"text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-700 font-medium",children:"点击选择图片或拍照（支持多图）"}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"支持 JPG、PNG 等图片格式"})]}),e.jsx("p",{className:"text-xs text-slate-400",children:"图片将作为病历附件保存，方便日后查阅"})]}),t===1&&e.jsx(je,{message:"AI正在识别病例图片，请稍候..."}),t===2&&a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-2xl p-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(oe,{size:16,className:"text-emerald-500"}),e.jsx("span",{className:"text-sm font-semibold text-emerald-600",children:"AI识别完成"})]}),e.jsx("p",{className:"text-xs text-slate-600",children:"已自动填充识别到的信息，请核对并补充，然后生成训练方案。"})]}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(de,{size:16,className:"text-slate-500"}),e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"病历附件"}),e.jsx("button",{onClick:()=>{u(0),c(null),x(null),b("")},className:"ml-auto text-xs text-rose-500 hover:text-rose-600 font-medium",children:"重新上传"})]}),e.jsx("img",{src:n,alt:"病历",className:"w-full max-h-40 object-contain rounded-xl border border-slate-200"})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-xl rounded-2xl p-4 border border-slate-100 shadow-sm",children:[e.jsxs("h5",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(ie,{size:16,className:"text-blue-500"}),"基本信息 ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"姓名 *"}),e.jsx("input",{type:"text",value:a.name,onChange:l=>p("name",l.target.value),placeholder:"请输入患儿姓名",className:"w-full border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 placeholder-slate-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 outline-none bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"年龄 *"}),e.jsx("input",{type:"text",value:a.age,onChange:l=>p("age",l.target.value),placeholder:"如：5岁3个月",className:"w-full border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 placeholder-slate-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 outline-none bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"性别 *"}),e.jsxs("select",{value:a.gender,onChange:l=>p("gender",l.target.value),className:"w-full border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 outline-none bg-white",children:[e.jsx("option",{value:"男",children:"男"}),e.jsx("option",{value:"女",children:"女"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"床号 *"}),e.jsx("input",{type:"text",value:a.bedNo,onChange:l=>p("bedNo",l.target.value),placeholder:"如：301-1",className:"w-full border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 placeholder-slate-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 outline-none bg-white"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"所属科室 *"}),e.jsx("input",{type:"text",value:a.department,onChange:l=>p("department",l.target.value),placeholder:"输入科室名称，如：呼吸内科",list:"department-list",className:"w-full border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 placeholder-slate-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 outline-none bg-white"}),e.jsx("datalist",{id:"department-list",children:Q.map(l=>e.jsxs("option",{value:l.name,children:[l.icon," ",l.name]},l.id))}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"可选择已有科室或输入新科室名称"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"诊断信息 *"}),e.jsx("textarea",{value:a.diagnosis,onChange:l=>p("diagnosis",l.target.value),placeholder:"请输入诊断信息",rows:2,className:"w-full border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 placeholder-slate-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 outline-none resize-none bg-white"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs text-slate-500 mb-1 block",children:"患儿状态 *"}),e.jsxs("select",{value:a.patientState||"配合度良好",onChange:l=>p("patientState",l.target.value),className:"w-full border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 outline-none bg-white",children:[e.jsx("option",{value:"配合度良好",children:"配合度良好 - 意识清醒，能主动配合训练"}),e.jsx("option",{value:"配合度一般",children:"配合度一般 - 意识清醒，需要引导配合"}),e.jsx("option",{value:"配合度差",children:"配合度差 - 意识清醒但抗拒训练"}),e.jsx("option",{value:"意识障碍",children:"意识障碍 - 嗜睡或意识模糊"}),e.jsx("option",{value:"昏迷",children:"昏迷 - 无意识反应"})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"患儿状态将影响治疗方案的选择"})]})]})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-xl rounded-2xl p-4 border border-slate-100 shadow-sm mb-4",children:[e.jsxs("h5",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(ce,{size:16,className:"text-amber-500"}),"当下存在的康复问题"]}),e.jsx("textarea",{value:a.rehabProblems||"",onChange:l=>x(j(h({},a),{rehabProblems:l.target.value})),placeholder:"描述患儿当前存在的康复问题，如：呼吸功能下降，运动耐力不足等",className:"w-full border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 placeholder-slate-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 outline-none bg-white resize-none",rows:"3"})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-xl rounded-2xl p-4 border border-slate-100 shadow-sm",children:[e.jsxs("h5",{className:"text-sm font-bold text-slate-700 mb-3 flex items-center gap-2",children:[e.jsx(xe,{size:16,className:"text-rose-500"}),"安全提醒"]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:a.safetyAlerts.map((l,d)=>e.jsxs("span",{className:"bg-rose-100 text-rose-600 text-xs px-2.5 py-1 rounded-xl flex items-center gap-1 font-medium",children:[l,e.jsx("button",{onClick:()=>D(d),className:"hover:text-rose-700",children:e.jsx(me,{size:12})})]},d))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:v,onChange:l=>y(l.target.value),placeholder:"添加安全提醒，如：防跌倒",className:"flex-1 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 placeholder-slate-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-100 outline-none bg-white",onKeyPress:l=>{l.key==="Enter"&&(f(v),y(""))}}),e.jsx("button",{onClick:()=>{f(v),y("")},className:"px-3 py-2 bg-rose-100 text-rose-600 rounded-xl text-sm font-semibold hover:bg-rose-200",children:"添加"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:["防跌倒","过敏体质","癫痫风险","禁止负重","监测血氧"].map(l=>e.jsxs("button",{onClick:()=>f(l),className:"text-xs px-2 py-0.5 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200",children:["+ ",l]},l))})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-xl rounded-2xl p-4 border border-slate-100 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h5",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(ue,{size:16,className:"text-emerald-500"}),"治疗计划（可选）"]}),e.jsx("button",{onClick:K,className:"text-xs text-blue-500 hover:text-blue-600 font-semibold",children:"+ 添加项目"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",value:a.treatmentPlan.focus,onChange:l=>x(d=>j(h({},d),{treatmentPlan:j(h({},d.treatmentPlan),{focus:l.target.value})})),placeholder:"治疗重点，如：改善呼吸功能，增强运动耐力（总时长20分钟）",className:"w-full border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-700 placeholder-slate-400 focus:border-blue-400 outline-none bg-white"})}),e.jsx("div",{className:"space-y-2",children:a.treatmentPlan.items.map((l,d)=>e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 rounded-xl p-2",children:[e.jsx("input",{type:"text",value:l.name,onChange:m=>P(d,"name",m.target.value),placeholder:"项目名称",className:"flex-1 border border-slate-200 rounded-lg px-2 py-1 text-sm text-slate-700 placeholder-slate-400 bg-white"}),e.jsx("input",{type:"text",value:l.duration,onChange:m=>P(d,"duration",m.target.value),placeholder:"时长",className:"w-20 border border-slate-200 rounded-lg px-2 py-1 text-sm text-slate-700 placeholder-slate-400 bg-white"}),e.jsx("button",{onClick:()=>F(d),className:"p-1 text-blue-500 hover:text-blue-600 hover:bg-blue-50 rounded transition-all",title:"替换项目",children:e.jsx(E,{size:14})}),e.jsx("button",{onClick:()=>V(d),className:"p-1 text-slate-400 hover:text-rose-500",children:e.jsx(be,{size:14})})]},d))})]}),e.jsxs("div",{className:"flex gap-3 pt-2 pb-4",children:[e.jsx("button",{onClick:()=>{u(0),x(null),c(null),b(""),q(0)},className:"flex-1 border border-slate-300 text-slate-600 py-3 rounded-xl font-semibold hover:bg-slate-50 transition",children:"取消"}),e.jsxs(S,{onClick:X,disabled:z,variant:"cyan",className:"flex-1 py-3 rounded-xl disabled:opacity-60",children:[e.jsx(L,{size:18}),"生成方案"]}),e.jsx(S,{onClick:$,disabled:N||z,variant:"emerald",className:`flex-1 py-3 rounded-xl ${N?"opacity-50 cursor-not-allowed":""}`,children:N?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:18,className:"animate-spin"}),"建档中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{size:18}),"确认建档"]})})]})]}),e.jsx(G,{isOpen:W,onClose:()=>w(!1),currentItem:C!==null?(R=a==null?void 0:a.treatmentPlan)==null?void 0:R.items[C]:null,alternatives:Z,onReplace:ee})]})};H.propTypes={isOpen:s.bool.isRequired,onClose:s.func.isRequired,aiStep:s.number.isRequired,setAiStep:s.func.isRequired,aiResult:s.object,setAiResult:s.func.isRequired,uploadedImage:s.string,setUploadedImage:s.func.isRequired,ocrText:s.string.isRequired,setOcrText:s.func.isRequired,ocrProgress:s.number.isRequired,setOcrProgress:s.func.isRequired,handleImageUpload:s.func.isRequired,updateFormField:s.func.isRequired,addSafetyAlert:s.func.isRequired,removeSafetyAlert:s.func.isRequired,addTreatmentItem:s.func.isRequired,updateTreatmentItem:s.func.isRequired,removeTreatmentItem:s.func.isRequired,handleGeneratePlan:s.func.isRequired,confirmAdmission:s.func.isRequired,isOcrProcessing:s.bool.isRequired,isSavingPatient:s.bool.isRequired,departments:s.arrayOf(s.shape({id:s.oneOfType([s.string,s.number]),name:s.string,icon:s.string})).isRequired};H.defaultProps={aiResult:null,uploadedImage:null};export{H as default};
