name: 检查部署文件

on:
  workflow_dispatch:

jobs:
  check-deployment:
    runs-on: ubuntu-latest

    steps:
    - name: 检查服务器文件
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        password: ${{ secrets.SERVER_PASSWORD }}
        port: ${{ secrets.SERVER_PORT || 22 }}
        script: |
          echo "========== 检查前端dist目录 =========="
          ls -la /var/www/rehab-care-link/dist/
          echo ""

          echo "========== 检查index.html内容 =========="
          cat /var/www/rehab-care-link/dist/index.html
          echo ""

          echo "========== 检查package.json =========="
          cat /var/www/rehab-care-link/package.json
          echo ""

          echo "========== 检查Nginx配置 =========="
          cat /etc/nginx/sites-available/ey.yushuo.click
          echo ""

          echo "========== 测试前端访问 =========="
          curl -I http://localhost/
